
{{> logo}}

<div class="w-2/3 mx-auto">
  <form action="/add" method="post">
    <div class="w-full mb-2">
      <input class="w-full m-1 rounded-md border-gray-300 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50" type="text" name="title" id="title" placeholder="Title" value="{{data.title}}" autofocus>
    </div>

    <!-- dropzone -->
    <div class="w-full h-36 border-2 border-dashed rounded-md mb-2 dropzone" id="add-recipe"></div>

    <div class="w-full mb-2">
      <textarea class="w-full m-1 rounded-md border-gray-300 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50" name="recipe" id="recipe" placeholder="Type recipe here" rows=12>{{data.recipe}}</textarea>
    </div>

    {{#if edit}}
      <input type="hidden" name="edit" id="edit" value="{{data.slug}}">
    {{/if}}

    <div class="grid grid-cols-3 gap-3 w-full mx-auto">
      {{#if back}}
        <a href="{{back}}">
      {{else}}
        <a href="/">
      {{/if}}
        <div class="w-full bg-red-100 hover:bg-red-200 p-3 rounded-md">
          X
        </div>
      </a>
      <div class="col-span-2">
        <input class="w-full bg-blue-300 hover:bg-blue-400 p-3 rounded-md cursor-pointer" type="submit" value="Save" id="submit-recipe">
      </div>
    </div>
  </form>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.5.1/min/dropzone.min.js"></script>
<script type="text/javascript">
Dropzone.autoDiscover = false;

theOne = new Dropzone("div#add-recipe", {
    autoProcessQueue: false,
    uploadMultiple: false,
    parallelUploads: 1,
    maxFiles: 1,
    maxFilesize: 3,
    paramName: 'recipe',
    url: "/add",
    dictDefaultMessage: '<img src="/img/upload.png" class="h-36 mx-auto p-3">',

    init: function() {
        var myDropzone = this;

        // First change the button to actually tell Dropzone to process the queue.
        document.getElementById("submit-recipe").addEventListener("click", function(e) {
          if (myDropzone.getQueuedFiles().length > 0) {
            // Make sure that the form isn't actually being sent.
            e.preventDefault();
            e.stopPropagation();
            myDropzone.processQueue();
          }
        });

        this.on("sending", function(data, xhr, formData) {
          formData.append("title", document.getElementById("title").value);
          formData.append("recipe", document.getElementById("recipe").value);
          formData.append("edit", document.getElementById("edit").value);
        });

        this.on("success", function(file, response) {
          window.location.href = response.url;
        });
    }
});
</script>